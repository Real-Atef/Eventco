'use strict';function Uploader(){this.holder=null;this.tests=null;this.support=null;this.acceptedTypes=null;this.progress=null;this.fileupload=null;this.cdMultimediaType=null;this.cdExtraParams=null;this.init()}
Uploader.prototype.init=function(){this.holder=document.getElementById("uploader_holder");this.progress=document.getElementById("uploader_uploadprogress");this.fileupload=document.getElementById("uploader_upload");this.tests={filereader:typeof FileReader!="undefined",dnd:"draggable"in document.createElement("span"),formdata:!!window.FormData,progress:"upload"in new XMLHttpRequest};this.support={filereader:$("#uploader_filereader"),formdata:$("#uploader_formdata"),progress:$("#uploader_progress")};this.acceptedTypes={"image/png":true,"image/jpeg":true,"image/gif":true};if(this.tests.filereader==false)this.support.filereader.show();else this.support.filereader.hide();if(this.tests.formdata==false)this.support.formdata.show();else this.support.formdata.hide();if(this.tests.progress==false)this.support.progress.show();else this.support.progress.hide();if(this.tests.dnd){this.holder.ondragover=function(){this.className="hover";return false};this.holder.ondragend=function(){this.className="";return false};this.holder.ondrop=function(e){this.className="";e.preventDefault();uploader.readfiles(e.dataTransfer.files)}}this.fileupload.querySelector("input").onchange=function(){uploader.readfiles(this.files)}};Uploader.prototype.previewfile=function(file){if(this.tests.filereader==true&&this.acceptedTypes[file.type]==true){var reader=new FileReader;reader.onload=function(event){var image=new Image;image.src=event.target.result;image.width=250;uploader.holder.appendChild(image)};reader.readAsDataURL(file)}else this.holder.innerHTML+="\x3cp\x3eUploaded "+file.name+" "+(file.size?(file.size/1024|0)+"K":"")};Uploader.prototype.readfiles=function(files){if(this.tests==undefined)return;var formData=this.tests.formdata?new FormData:null;if(this.tests.formdata){for(var i=0;i<files.length;i++)formData.append("file",files[i]);var xhr=new XMLHttpRequest;var url="http://localhost/uploadMultimediaHandler.do?cdMultimediaType\x3d"+this.cdMultimediaType;if(this.cdExtraParams)url+="\x26"+this.cdExtraParams;xhr.open("get",url);xhr.onload=function(){uploader.progress.value=uploader.progress.innerHTML=100};if(this.tests.progress)xhr.upload.onprogress=function(event){if(event.lengthComputable){var complete=event.loaded/event.total*100|0;progress.value=progress.innerHTML=complete}};xhr.send(formData);for(var i=0;i<files.length;i++)this.previewfile(files[i])}};